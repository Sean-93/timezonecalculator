<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Time Zone Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
</head>

<body>
    <h1>Time Zone Converter</h1>

    <label for="fromZone">From Time Zone:</label>
    <select id="fromZone" name="fromZone"></select>

    <label for="fromTime">Time (HH:MM 24h):</label>
    <input type="time" id="fromTime" name="fromTime">

    <div>
        <label>To Time Zones:</label>
        <div id="toZones"></div>
        <button id="addZoneBtn">+ Add Time Zone</button>
    </div>

    <button id="convertBtn">Convert</button>

    <div id="results"></div>

    <script>
        'use strict';

        (function () {
            const { DateTime } = luxon;
            const fromZoneEl = document.getElementById('fromZone');
            const fromTimeEl = document.getElementById('fromTime');
            const toZonesContainer = document.getElementById('toZones');
            const resultsEl = document.getElementById('results');
            const addZoneBtn = document.getElementById('addZoneBtn');
            const convertBtn = document.getElementById('convertBtn');

            let allZones = [];

            // GET ALL SUPPORTED TIME ZONES, WITH A FALLBACK IF NOT SUPPORTED
            function getAllTimeZones() {
                try {
                    return Intl.supportedValuesOf('timeZone');
                } catch {
                    return [
                        'UTC',
                        'America/New_York',
                        'America/Chicago',
                        'America/Denver',
                        'America/Los_Angeles',
                        'America/Anchorage',
                        'America/Honolulu',
                        'America/Argentina/Buenos_Aires',
                        'Europe/London',
                        'Europe/Paris',
                        'Europe/Berlin',
                        'Europe/Madrid',
                        'Europe/Rome',
                        'Europe/Stockholm',
                        'Europe/Helsinki',
                        'Asia/Tokyo',
                        'Asia/Seoul',
                        'Asia/Shanghai',
                        'Asia/Hong_Kong',
                        'Asia/Kolkata',
                        'Asia/Singapore',
                        'Asia/Dubai',
                        'Australia/Sydney',
                        'Australia/Melbourne',
                        'Australia/Brisbane',
                        'Australia/Perth',
                        'Africa/Johannesburg',
                        'Africa/Cairo',
                        'Africa/Nairobi',
                        'Africa/Lagos',
                        'Pacific/Fiji',
                        'Pacific/Auckland',
                        'Pacific/Honolulu',
                        'America/Sao_Paulo',
                        'America/Mexico_City',
                        'America/Lima',
                        'America/Bogota',
                        'America/Caracas',
                        'America/Toronto',
                        'Europe/Oslo',
                        'Europe/Dublin',
                        'Europe/Vienna',
                        'Asia/Kuala_Lumpur',
                        'Asia/Jakarta',
                        'Asia/Manila',
                        'Asia/Taipei',
                        'Asia/Bangkok',
                        'Pacific/Apia',
                        'Pacific/Tongatapu',
                        'America/Guatemala',
                        'America/Edmonton',
                        'America/Vancouver',
                        'Asia/Baghdad',
                        'Europe/Amsterdam',
                        'Europe/Brussels',
                        'Europe/Zurich',
                        'Europe/Prague',
                        'Africa/Abidjan',
                        'Africa/Accra',
                        'Africa/Kigali',
                        'Africa/Tunis',
                        'Africa/Lagos',
                        'Asia/Tehran',
                        'Asia/Tashkent',
                        'Asia/Dhaka',
                        'Asia/Yangon',
                        'Asia/Almaty',
                        'Pacific/Port_Moresby',
                        'America/Montevideo',
                        'America/Quito',
                        'America/La_Paz',
                        'Asia/Kathmandu',
                        'Asia/Chennai',
                        'Asia/Ho_Chi_Minh',
                        'Asia/Phnom_Penh',
                        'America/Kingston',
                        'America/Port_of_Spain',
                        'America/Guyana',
                        'America/Curacao',
                        'America/St_Johns'
                    ];
                }
            }

            // POPULATE TIME ZONE SELECT DROPDOWN
            function populateTimeZoneSelect(selectEl, defaultZone = 'UTC') {
                allZones.forEach(zone => {
                    const opt = document.createElement('option');
                    opt.value = zone;
                    opt.textContent = zone;
                    selectEl.appendChild(opt);
                });
                selectEl.value = defaultZone;
            }

            // CREATE A ROW FOR ADDING TIME ZONE SELECTORS
            function createToZoneRow(defaultZone = 'UTC') {
                const container = document.createElement('div');
                const select = document.createElement('select');
                populateTimeZoneSelect(select, defaultZone);

                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', () => {
                    if (toZonesContainer.childElementCount > 1) {
                        container.remove();
                    } else {
                        alert('At least one time zone must remain.');
                    }
                });

                container.appendChild(select);
                container.appendChild(removeBtn);
                toZonesContainer.appendChild(container);
            }

            // ADD A NEW TIME ZONE SELECTOR ROW
            function addTimeZone() {
                createToZoneRow();
            }

            // CONVERT THE TIME FROM THE 'FROM' ZONE TO ALL 'TO' ZONES
            function convertTime() {
                const inputTime = fromTimeEl.value;
                const fromTz = fromZoneEl.value;
                resultsEl.innerHTML = '';

                // VALIDATE THE INPUT TIME FORMAT
                if (!inputTime || !/^\d{2}:\d{2}$/.test(inputTime)) {
                    resultsEl.textContent = 'Please enter a valid time.';
                    return;
                }

                const [hour, minute] = inputTime.split(':').map(Number);
                if (hour > 23 || minute > 59) {
                    resultsEl.textContent = 'Invalid time input.';
                    return;
                }

                // CREATE A 'FROM' TIME ZONE DATE OBJECT
                const now = DateTime.now().setZone(fromTz);
                const fromTime = DateTime.fromObject({
                    year: now.year,
                    month: now.month,
                    day: now.day,
                    hour,
                    minute
                }, { zone: fromTz });

                // LOOP THROUGH 'TO' ZONE SELECTORS AND CONVERT TIME
                const toSelectors = toZonesContainer.querySelectorAll('select');
                toSelectors.forEach(select => {
                    const toTz = select.value;
                    const converted = fromTime.setZone(toTz);
                    const resultLine = document.createElement('div');
                    resultLine.textContent = `${fromTime.toFormat('HH:mm')} in ${fromTz} = ${converted.toFormat('HH:mm')} in ${toTz}`;
                    resultsEl.appendChild(resultLine);
                });
            }

            // INITIALIZE THE APP: LOAD TIME ZONES, SET DEFAULT ZONE, AND SET UP EVENTS
            function init() {
                allZones = getAllTimeZones().sort();
                populateTimeZoneSelect(fromZoneEl, Intl.DateTimeFormat().resolvedOptions().timeZone);
                createToZoneRow('UTC');

                addZoneBtn.addEventListener('click', addTimeZone);
                convertBtn.addEventListener('click', convertTime);
            }

            init();
        })();
    </script>
</body>

</html>